{"version":3,"sources":["webpack:///node_modules/@firebase/analytics/dist/index.esm.js","webpack:///node_modules/firebase/analytics/dist/index.esm.js","webpack:///node_modules/@firebase/installations/dist/index.esm.js","webpack:///node_modules/idb/build/idb.js"],"names":["GA_FID_KEY","ORIGIN_KEY","FETCH_TIMEOUT_MILLIS","DYNAMIC_CONFIG_URL","GTAG_URL","GtagCommand","EventName","logEvent","gtagFunction","initializationPromise","eventName","eventParams","options","measurementId","params","_a","label","global","EVENT","sent","setCurrentScreen","screenName","SET","Promise","resolve","CONFIG","update","setUserId","id","setUserProperties","properties","flatProperties","_i","key","_b","Object","keys","length","setAnalyticsCollectionEnabled","enabled","window","logger","insertScriptTag","dataLayerName","script","document","createElement","src","async","head","appendChild","getOrCreateDataLayer","dataLayer","Array","isArray","gtagOnConfig","gtagCore","initializationPromisesMap","dynamicConfigPromisesList","measurementIdToAppId","gtagParams","correspondingAppId","dynamicConfigResults","foundConfig","e_1","trys","push","all","find","config","appId","error","gtagOnEvent","initializationPromisesToWaitFor","gaSendToList","_loop_1","gaSendToList_1","sendToId","state_1","e_2","values","wrapGtag","gtagWrapper","command","idOrNameOrParams","e_3","wrapOrCreateGtag","gtagFunctionName","_args","arguments","wrappedGtag","findGtagScriptOnPage","scriptTags","getElementsByTagName","tag","includes","ERRORS","ERROR_FACTORY","LONG_RETRY_FACTOR","BASE_INTERVAL_MILLIS","RetryData","throttleMetadata","intervalMillis","prototype","getThrottleMetadata","setThrottleMetadata","metadata","deleteThrottleMetadata","defaultRetryData","getHeaders","apiKey","Headers","Accept","fetchDynamicConfig","appFields","request","appUrl","response","errorMessage","jsonResponse","method","headers","replace","fetch","status","json","message","create","httpStatus","responseMessage","fetchDynamicConfigWithRetry","app","retryData","timeoutMillis","signal","_this","backoffCount","throttleEndTimeMillis","Date","now","AnalyticsAbortSignal","setTimeout","abort","undefined","attemptFetchDynamicConfigWithRetry","backoffMillis","setAbortableTimeout","warn","isRetriableError","Number","customData","debug","reject","Math","max","timeout","addEventListener","clearTimeout","e","listeners","listener","forEach","validateIndexedDB","errorInfo","initializeIds","installations","dynamicConfigPromise","fidPromise","dynamicConfig","fid","configProperties","_c","then","envIsValid","getId","gtagName","gtagCoreFunction","wrappedGtagFunction","globalInitDone","resetGlobalVars","newGlobalInitDone","newInitializationPromisesMap","newDynamicPromises","getGlobalVars","settings","warnOnBrowserContextMismatch","mismatchedEnvMessages","details","map","index","join","err","factory","analyticsInstance","INTERNAL","name","version","ANALYTICS_TYPE","registerAnalytics","instance","registerComponent","container","getProvider","getImmediate","setServiceProps","isSupported","internalFactory","registerVersion","analytics","reason","isDBOpenable","PENDING_TIMEOUT_MS","PACKAGE_VERSION","INTERNAL_AUTH_VERSION","INSTALLATIONS_API_URL","TOKEN_EXPIRATION_BUFFER","SERVICE","SERVICE_NAME","ERROR_DESCRIPTION_MAP","isServerError","code","getInstallationsEndpoint","projectId","extractAuthTokenInfoFromResponse","token","requestStatus","expiresIn","getExpiresInFromResponseExpiresIn","creationTime","getErrorFromResponse","requestName","responseJson","errorData","serverCode","serverMessage","serverStatus","getHeadersWithAuth","appConfig","refreshToken","append","getAuthorizationHeader","retryIfServerError","fn","result","responseExpiresIn","createInstallationRequest","endpoint","body","responseValue","registeredInstallationEntry","authVersion","sdkVersion","JSON","stringify","ok","registrationStatus","authToken","sleep","ms","bufferToBase64UrlSafe","array","b64","btoa","String","fromCharCode","apply","VALID_FID_PATTERN","INVALID_FID","generateFid","fidByteArray","Uint8Array","crypto_1","self","crypto","msCrypto","getRandomValues","encode","test","b64String","substr","getKey","appName","fidChangeCallbacks","Map","fidChanged","callFidChangeCallbacks","broadcastFidChange","addCallback","callback","getBroadcastChannel","callbackSet","get","Set","set","add","removeCallback","size","closeBroadcastChannel","callbacks","callbacks_1","callbacks_1_1","next","done","value","e_1_1","call","channel","postMessage","broadcastChannel","BroadcastChannel","onmessage","data","close","DATABASE_NAME","DATABASE_VERSION","OBJECT_STORE_NAME","dbPromise","getDbPromise","upgradeDB","oldVersion","createObjectStore","db","tx","objectStore","oldValue","transaction","put","complete","remove","updateFn","store","newValue","getInstallationEntry","registrationPromise","installationEntry","oldEntry","updateOrCreateInstallationEntry","entryWithPromise","triggerRegistrationIfNecessary","entry","clearTimedOutRequest","navigator","onLine","registrationPromiseWithError","inProgressEntry","registrationTime","registerInstallation","waitUntilFidRegistration","updateInstallationRequest","hasInstallationRequestTimedOut","generateAuthTokenRequest","platformLoggerProvider","platformLogger","completedAuthToken","getGenerateAuthTokenEndpoint","optional","getPlatformInfoString","installation","refreshAuthToken","dependencies","forceRefresh","tokenPromise","isEntryRegistered","oldAuthToken","isAuthTokenValid","waitUntilAuthTokenRequest","makeAuthTokenRequestInProgressEntry","fetchAuthTokenFromServer","updateAuthTokenRequest","hasAuthTokenRequestTimedOut","updatedInstallationEntry","isAuthTokenExpired","inProgressAuthToken","requestTime","console","getToken","completeInstallationRegistration","deleteInstallationRequest","getDeleteEndpoint","deleteInstallation","onIdChange","extractAppConfig","getMissingValueError","configKeys","configKeys_1","configKeys_1_1","keyName","valueName","registerInstallations","installationsName","exports","toArray","arr","slice","promisifyRequest","onsuccess","onerror","promisifyRequestCall","obj","args","p","promisifyCursorRequestCall","Cursor","proxyProperties","ProxyClass","targetProp","prop","defineProperty","val","proxyRequestMethods","Constructor","proxyMethods","proxyCursorRequestMethods","Index","_index","IDBIndex","cursor","_cursor","_request","IDBCursor","methodName","ObjectStore","_store","createIndex","IDBObjectStore","Transaction","idbTransaction","_tx","oncomplete","onabort","IDBTransaction","UpgradeDB","_db","IDBDatabase","DB","funcName","nativeObject","getAll","query","count","items","iterateCursor","openDb","upgradeCallback","indexedDB","onupgradeneeded","event","deleteDb"],"mappings":"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","file":"firebase-analytics-es5.js","sourcesContent":["import { __awaiter, __generator, __assign } from 'tslib';\nimport firebase from '@firebase/app';\nimport '@firebase/installations';\nimport { Logger } from '@firebase/logger';\nimport { ErrorFactory, calculateBackoffMillis, FirebaseError, validateIndexedDBOpenable, isIndexedDBAvailable, isBrowserExtension, areCookiesEnabled } from '@firebase/util';\nimport { Component } from '@firebase/component';\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n// Key to attach FID to in gtag params.\r\nvar GA_FID_KEY = 'firebase_id';\r\nvar ORIGIN_KEY = 'origin';\r\nvar FETCH_TIMEOUT_MILLIS = 60 * 1000;\r\nvar DYNAMIC_CONFIG_URL = 'https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig';\r\nvar GTAG_URL = 'https://www.googletagmanager.com/gtag/js';\r\nvar GtagCommand;\r\n(function (GtagCommand) {\r\n    GtagCommand[\"EVENT\"] = \"event\";\r\n    GtagCommand[\"SET\"] = \"set\";\r\n    GtagCommand[\"CONFIG\"] = \"config\";\r\n})(GtagCommand || (GtagCommand = {}));\r\n/**\r\n * Officially recommended event names for gtag.js\r\n * Any other string is also allowed.\r\n *\r\n * @public\r\n */\r\nvar EventName;\r\n(function (EventName) {\r\n    EventName[\"ADD_SHIPPING_INFO\"] = \"add_shipping_info\";\r\n    EventName[\"ADD_PAYMENT_INFO\"] = \"add_payment_info\";\r\n    EventName[\"ADD_TO_CART\"] = \"add_to_cart\";\r\n    EventName[\"ADD_TO_WISHLIST\"] = \"add_to_wishlist\";\r\n    EventName[\"BEGIN_CHECKOUT\"] = \"begin_checkout\";\r\n    /**\r\n     * @deprecated\r\n     * This event name is deprecated and is unsupported in updated\r\n     * Enhanced Ecommerce reports.\r\n     */\r\n    EventName[\"CHECKOUT_PROGRESS\"] = \"checkout_progress\";\r\n    EventName[\"EXCEPTION\"] = \"exception\";\r\n    EventName[\"GENERATE_LEAD\"] = \"generate_lead\";\r\n    EventName[\"LOGIN\"] = \"login\";\r\n    EventName[\"PAGE_VIEW\"] = \"page_view\";\r\n    EventName[\"PURCHASE\"] = \"purchase\";\r\n    EventName[\"REFUND\"] = \"refund\";\r\n    EventName[\"REMOVE_FROM_CART\"] = \"remove_from_cart\";\r\n    EventName[\"SCREEN_VIEW\"] = \"screen_view\";\r\n    EventName[\"SEARCH\"] = \"search\";\r\n    EventName[\"SELECT_CONTENT\"] = \"select_content\";\r\n    EventName[\"SELECT_ITEM\"] = \"select_item\";\r\n    EventName[\"SELECT_PROMOTION\"] = \"select_promotion\";\r\n    /** @deprecated */\r\n    EventName[\"SET_CHECKOUT_OPTION\"] = \"set_checkout_option\";\r\n    EventName[\"SHARE\"] = \"share\";\r\n    EventName[\"SIGN_UP\"] = \"sign_up\";\r\n    EventName[\"TIMING_COMPLETE\"] = \"timing_complete\";\r\n    EventName[\"VIEW_CART\"] = \"view_cart\";\r\n    EventName[\"VIEW_ITEM\"] = \"view_item\";\r\n    EventName[\"VIEW_ITEM_LIST\"] = \"view_item_list\";\r\n    EventName[\"VIEW_PROMOTION\"] = \"view_promotion\";\r\n    EventName[\"VIEW_SEARCH_RESULTS\"] = \"view_search_results\";\r\n})(EventName || (EventName = {}));\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Logs an analytics event through the Firebase SDK.\r\n *\r\n * @param gtagFunction Wrapped gtag function that waits for fid to be set before sending an event\r\n * @param eventName Google Analytics event name, choose from standard list or use a custom string.\r\n * @param eventParams Analytics event parameters.\r\n */\r\nfunction logEvent(gtagFunction, initializationPromise, eventName, eventParams, options) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var measurementId, params;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    if (!(options && options.global)) return [3 /*break*/, 1];\r\n                    gtagFunction(GtagCommand.EVENT, eventName, eventParams);\r\n                    return [2 /*return*/];\r\n                case 1: return [4 /*yield*/, initializationPromise];\r\n                case 2:\r\n                    measurementId = _a.sent();\r\n                    params = __assign(__assign({}, eventParams), { 'send_to': measurementId });\r\n                    gtagFunction(GtagCommand.EVENT, eventName, params);\r\n                    _a.label = 3;\r\n                case 3: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Set screen_name parameter for this Google Analytics ID.\r\n *\r\n * @param gtagFunction Wrapped gtag function that waits for fid to be set before sending an event\r\n * @param screenName Screen name string to set.\r\n */\r\nfunction setCurrentScreen(gtagFunction, initializationPromise, screenName, options) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var measurementId;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    if (!(options && options.global)) return [3 /*break*/, 1];\r\n                    gtagFunction(GtagCommand.SET, { 'screen_name': screenName });\r\n                    return [2 /*return*/, Promise.resolve()];\r\n                case 1: return [4 /*yield*/, initializationPromise];\r\n                case 2:\r\n                    measurementId = _a.sent();\r\n                    gtagFunction(GtagCommand.CONFIG, measurementId, {\r\n                        update: true,\r\n                        'screen_name': screenName\r\n                    });\r\n                    _a.label = 3;\r\n                case 3: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Set user_id parameter for this Google Analytics ID.\r\n *\r\n * @param gtagFunction Wrapped gtag function that waits for fid to be set before sending an event\r\n * @param id User ID string to set\r\n */\r\nfunction setUserId(gtagFunction, initializationPromise, id, options) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var measurementId;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    if (!(options && options.global)) return [3 /*break*/, 1];\r\n                    gtagFunction(GtagCommand.SET, { 'user_id': id });\r\n                    return [2 /*return*/, Promise.resolve()];\r\n                case 1: return [4 /*yield*/, initializationPromise];\r\n                case 2:\r\n                    measurementId = _a.sent();\r\n                    gtagFunction(GtagCommand.CONFIG, measurementId, {\r\n                        update: true,\r\n                        'user_id': id\r\n                    });\r\n                    _a.label = 3;\r\n                case 3: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Set all other user properties other than user_id and screen_name.\r\n *\r\n * @param gtagFunction Wrapped gtag function that waits for fid to be set before sending an event\r\n * @param properties Map of user properties to set\r\n */\r\nfunction setUserProperties(gtagFunction, initializationPromise, properties, options) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var flatProperties, _i, _a, key, measurementId;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0:\r\n                    if (!(options && options.global)) return [3 /*break*/, 1];\r\n                    flatProperties = {};\r\n                    for (_i = 0, _a = Object.keys(properties); _i < _a.length; _i++) {\r\n                        key = _a[_i];\r\n                        // use dot notation for merge behavior in gtag.js\r\n                        flatProperties[\"user_properties.\" + key] = properties[key];\r\n                    }\r\n                    gtagFunction(GtagCommand.SET, flatProperties);\r\n                    return [2 /*return*/, Promise.resolve()];\r\n                case 1: return [4 /*yield*/, initializationPromise];\r\n                case 2:\r\n                    measurementId = _b.sent();\r\n                    gtagFunction(GtagCommand.CONFIG, measurementId, {\r\n                        update: true,\r\n                        'user_properties': properties\r\n                    });\r\n                    _b.label = 3;\r\n                case 3: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Set whether collection is enabled for this ID.\r\n *\r\n * @param enabled If true, collection is enabled for this ID.\r\n */\r\nfunction setAnalyticsCollectionEnabled(initializationPromise, enabled) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var measurementId;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, initializationPromise];\r\n                case 1:\r\n                    measurementId = _a.sent();\r\n                    window[\"ga-disable-\" + measurementId] = !enabled;\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar logger = new Logger('@firebase/analytics');\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Inserts gtag script tag into the page to asynchronously download gtag.\r\n * @param dataLayerName Name of datalayer (most often the default, \"_dataLayer\").\r\n */\r\nfunction insertScriptTag(dataLayerName, measurementId) {\r\n    var script = document.createElement('script');\r\n    script.src = GTAG_URL + \"?l=\" + dataLayerName + \"&id=\" + measurementId;\r\n    script.async = true;\r\n    document.head.appendChild(script);\r\n}\r\n/**\r\n * Get reference to, or create, global datalayer.\r\n * @param dataLayerName Name of datalayer (most often the default, \"_dataLayer\").\r\n */\r\nfunction getOrCreateDataLayer(dataLayerName) {\r\n    // Check for existing dataLayer and create if needed.\r\n    var dataLayer = [];\r\n    if (Array.isArray(window[dataLayerName])) {\r\n        dataLayer = window[dataLayerName];\r\n    }\r\n    else {\r\n        window[dataLayerName] = dataLayer;\r\n    }\r\n    return dataLayer;\r\n}\r\n/**\r\n * Wrapped gtag logic when gtag is called with 'config' command.\r\n *\r\n * @param gtagCore Basic gtag function that just appends to dataLayer.\r\n * @param initializationPromisesMap Map of appIds to their initialization promises.\r\n * @param dynamicConfigPromisesList Array of dynamic config fetch promises.\r\n * @param measurementIdToAppId Map of GA measurementIDs to corresponding Firebase appId.\r\n * @param measurementId GA Measurement ID to set config for.\r\n * @param gtagParams Gtag config params to set.\r\n */\r\nfunction gtagOnConfig(gtagCore, initializationPromisesMap, dynamicConfigPromisesList, measurementIdToAppId, measurementId, gtagParams) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var correspondingAppId, dynamicConfigResults, foundConfig, e_1;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    correspondingAppId = measurementIdToAppId[measurementId];\r\n                    _a.label = 1;\r\n                case 1:\r\n                    _a.trys.push([1, 7, , 8]);\r\n                    if (!correspondingAppId) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, initializationPromisesMap[correspondingAppId]];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [3 /*break*/, 6];\r\n                case 3: return [4 /*yield*/, Promise.all(dynamicConfigPromisesList)];\r\n                case 4:\r\n                    dynamicConfigResults = _a.sent();\r\n                    foundConfig = dynamicConfigResults.find(function (config) { return config.measurementId === measurementId; });\r\n                    if (!foundConfig) return [3 /*break*/, 6];\r\n                    return [4 /*yield*/, initializationPromisesMap[foundConfig.appId]];\r\n                case 5:\r\n                    _a.sent();\r\n                    _a.label = 6;\r\n                case 6: return [3 /*break*/, 8];\r\n                case 7:\r\n                    e_1 = _a.sent();\r\n                    logger.error(e_1);\r\n                    return [3 /*break*/, 8];\r\n                case 8:\r\n                    gtagCore(GtagCommand.CONFIG, measurementId, gtagParams);\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Wrapped gtag logic when gtag is called with 'event' command.\r\n *\r\n * @param gtagCore Basic gtag function that just appends to dataLayer.\r\n * @param initializationPromisesMap Map of appIds to their initialization promises.\r\n * @param dynamicConfigPromisesList Array of dynamic config fetch promises.\r\n * @param measurementId GA Measurement ID to log event to.\r\n * @param gtagParams Params to log with this event.\r\n */\r\nfunction gtagOnEvent(gtagCore, initializationPromisesMap, dynamicConfigPromisesList, measurementId, gtagParams) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var initializationPromisesToWaitFor, gaSendToList, dynamicConfigResults, _loop_1, _i, gaSendToList_1, sendToId, state_1, e_2;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    _a.trys.push([0, 4, , 5]);\r\n                    initializationPromisesToWaitFor = [];\r\n                    if (!(gtagParams && gtagParams['send_to'])) return [3 /*break*/, 2];\r\n                    gaSendToList = gtagParams['send_to'];\r\n                    // Make it an array if is isn't, so it can be dealt with the same way.\r\n                    if (!Array.isArray(gaSendToList)) {\r\n                        gaSendToList = [gaSendToList];\r\n                    }\r\n                    return [4 /*yield*/, Promise.all(dynamicConfigPromisesList)];\r\n                case 1:\r\n                    dynamicConfigResults = _a.sent();\r\n                    _loop_1 = function (sendToId) {\r\n                        // Any fetched dynamic measurement ID that matches this 'send_to' ID\r\n                        var foundConfig = dynamicConfigResults.find(function (config) { return config.measurementId === sendToId; });\r\n                        var initializationPromise = foundConfig && initializationPromisesMap[foundConfig.appId];\r\n                        if (initializationPromise) {\r\n                            initializationPromisesToWaitFor.push(initializationPromise);\r\n                        }\r\n                        else {\r\n                            // Found an item in 'send_to' that is not associated\r\n                            // directly with an FID, possibly a group.  Empty this array,\r\n                            // exit the loop early, and let it get populated below.\r\n                            initializationPromisesToWaitFor = [];\r\n                            return \"break\";\r\n                        }\r\n                    };\r\n                    for (_i = 0, gaSendToList_1 = gaSendToList; _i < gaSendToList_1.length; _i++) {\r\n                        sendToId = gaSendToList_1[_i];\r\n                        state_1 = _loop_1(sendToId);\r\n                        if (state_1 === \"break\")\r\n                            break;\r\n                    }\r\n                    _a.label = 2;\r\n                case 2:\r\n                    // This will be unpopulated if there was no 'send_to' field , or\r\n                    // if not all entries in the 'send_to' field could be mapped to\r\n                    // a FID. In these cases, wait on all pending initialization promises.\r\n                    if (initializationPromisesToWaitFor.length === 0) {\r\n                        initializationPromisesToWaitFor = Object.values(initializationPromisesMap);\r\n                    }\r\n                    // Run core gtag function with args after all relevant initialization\r\n                    // promises have been resolved.\r\n                    return [4 /*yield*/, Promise.all(initializationPromisesToWaitFor)];\r\n                case 3:\r\n                    // Run core gtag function with args after all relevant initialization\r\n                    // promises have been resolved.\r\n                    _a.sent();\r\n                    // Workaround for http://b/141370449 - third argument cannot be undefined.\r\n                    gtagCore(GtagCommand.EVENT, measurementId, gtagParams || {});\r\n                    return [3 /*break*/, 5];\r\n                case 4:\r\n                    e_2 = _a.sent();\r\n                    logger.error(e_2);\r\n                    return [3 /*break*/, 5];\r\n                case 5: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Wraps a standard gtag function with extra code to wait for completion of\r\n * relevant initialization promises before sending requests.\r\n *\r\n * @param gtagCore Basic gtag function that just appends to dataLayer.\r\n * @param initializationPromisesMap Map of appIds to their initialization promises.\r\n * @param dynamicConfigPromisesList Array of dynamic config fetch promises.\r\n * @param measurementIdToAppId Map of GA measurementIDs to corresponding Firebase appId.\r\n */\r\nfunction wrapGtag(gtagCore, \r\n/**\r\n * Allows wrapped gtag calls to wait on whichever intialization promises are required,\r\n * depending on the contents of the gtag params' `send_to` field, if any.\r\n */\r\ninitializationPromisesMap, \r\n/**\r\n * Wrapped gtag calls sometimes require all dynamic config fetches to have returned\r\n * before determining what initialization promises (which include FIDs) to wait for.\r\n */\r\ndynamicConfigPromisesList, \r\n/**\r\n * Wrapped gtag config calls can narrow down which initialization promise (with FID)\r\n * to wait for if the measurementId is already fetched, by getting the corresponding appId,\r\n * which is the key for the initialization promises map.\r\n */\r\nmeasurementIdToAppId) {\r\n    /**\r\n     * Wrapper around gtag that ensures FID is sent with gtag calls.\r\n     * @param command Gtag command type.\r\n     * @param idOrNameOrParams Measurement ID if command is EVENT/CONFIG, params if command is SET.\r\n     * @param gtagParams Params if event is EVENT/CONFIG.\r\n     */\r\n    function gtagWrapper(command, idOrNameOrParams, gtagParams) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var e_3;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        _a.trys.push([0, 6, , 7]);\r\n                        if (!(command === GtagCommand.EVENT)) return [3 /*break*/, 2];\r\n                        // If EVENT, second arg must be measurementId.\r\n                        return [4 /*yield*/, gtagOnEvent(gtagCore, initializationPromisesMap, dynamicConfigPromisesList, idOrNameOrParams, gtagParams)];\r\n                    case 1:\r\n                        // If EVENT, second arg must be measurementId.\r\n                        _a.sent();\r\n                        return [3 /*break*/, 5];\r\n                    case 2:\r\n                        if (!(command === GtagCommand.CONFIG)) return [3 /*break*/, 4];\r\n                        // If CONFIG, second arg must be measurementId.\r\n                        return [4 /*yield*/, gtagOnConfig(gtagCore, initializationPromisesMap, dynamicConfigPromisesList, measurementIdToAppId, idOrNameOrParams, gtagParams)];\r\n                    case 3:\r\n                        // If CONFIG, second arg must be measurementId.\r\n                        _a.sent();\r\n                        return [3 /*break*/, 5];\r\n                    case 4:\r\n                        // If SET, second arg must be params.\r\n                        gtagCore(GtagCommand.SET, idOrNameOrParams);\r\n                        _a.label = 5;\r\n                    case 5: return [3 /*break*/, 7];\r\n                    case 6:\r\n                        e_3 = _a.sent();\r\n                        logger.error(e_3);\r\n                        return [3 /*break*/, 7];\r\n                    case 7: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    }\r\n    return gtagWrapper;\r\n}\r\n/**\r\n * Creates global gtag function or wraps existing one if found.\r\n * This wrapped function attaches Firebase instance ID (FID) to gtag 'config' and\r\n * 'event' calls that belong to the GAID associated with this Firebase instance.\r\n *\r\n * @param initializationPromisesMap Map of appIds to their initialization promises.\r\n * @param dynamicConfigPromisesList Array of dynamic config fetch promises.\r\n * @param measurementIdToAppId Map of GA measurementIDs to corresponding Firebase appId.\r\n * @param dataLayerName Name of global GA datalayer array.\r\n * @param gtagFunctionName Name of global gtag function (\"gtag\" if not user-specified).\r\n */\r\nfunction wrapOrCreateGtag(initializationPromisesMap, dynamicConfigPromisesList, measurementIdToAppId, dataLayerName, gtagFunctionName) {\r\n    // Create a basic core gtag function\r\n    var gtagCore = function () {\r\n        var _args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            _args[_i] = arguments[_i];\r\n        }\r\n        // Must push IArguments object, not an array.\r\n        window[dataLayerName].push(arguments);\r\n    };\r\n    // Replace it with existing one if found\r\n    if (window[gtagFunctionName] &&\r\n        typeof window[gtagFunctionName] === 'function') {\r\n        // @ts-ignore\r\n        gtagCore = window[gtagFunctionName];\r\n    }\r\n    window[gtagFunctionName] = wrapGtag(gtagCore, initializationPromisesMap, dynamicConfigPromisesList, measurementIdToAppId);\r\n    return {\r\n        gtagCore: gtagCore,\r\n        wrappedGtag: window[gtagFunctionName]\r\n    };\r\n}\r\n/**\r\n * Returns first script tag in DOM matching our gtag url pattern.\r\n */\r\nfunction findGtagScriptOnPage() {\r\n    var scriptTags = window.document.getElementsByTagName('script');\r\n    for (var _i = 0, _a = Object.values(scriptTags); _i < _a.length; _i++) {\r\n        var tag = _a[_i];\r\n        if (tag.src && tag.src.includes(GTAG_URL)) {\r\n            return tag;\r\n        }\r\n    }\r\n    return null;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar _a;\r\nvar ERRORS = (_a = {},\r\n    _a[\"already-exists\" /* ALREADY_EXISTS */] = 'A Firebase Analytics instance with the appId {$id} ' +\r\n        ' already exists. ' +\r\n        'Only one Firebase Analytics instance can be created for each appId.',\r\n    _a[\"already-initialized\" /* ALREADY_INITIALIZED */] = 'Firebase Analytics has already been initialized.' +\r\n        'settings() must be called before initializing any Analytics instance' +\r\n        'or it will have no effect.',\r\n    _a[\"interop-component-reg-failed\" /* INTEROP_COMPONENT_REG_FAILED */] = 'Firebase Analytics Interop Component failed to instantiate: {$reason}',\r\n    _a[\"invalid-analytics-context\" /* INVALID_ANALYTICS_CONTEXT */] = 'Firebase Analytics is not supported in this environment. ' +\r\n        'Wrap initialization of analytics in analytics.isSupported() ' +\r\n        'to prevent initialization in unsupported environments. Details: {$errorInfo}',\r\n    _a[\"indexeddb-unavailable\" /* INDEXEDDB_UNAVAILABLE */] = 'IndexedDB unavailable or restricted in this environment. ' +\r\n        'Wrap initialization of analytics in analytics.isSupported() ' +\r\n        'to prevent initialization in unsupported environments. Details: {$errorInfo}',\r\n    _a[\"fetch-throttle\" /* FETCH_THROTTLE */] = 'The config fetch request timed out while in an exponential backoff state.' +\r\n        ' Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',\r\n    _a[\"config-fetch-failed\" /* CONFIG_FETCH_FAILED */] = 'Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}',\r\n    _a[\"no-api-key\" /* NO_API_KEY */] = 'The \"apiKey\" field is empty in the local Firebase config. Firebase Analytics requires this field to' +\r\n        'contain a valid API key.',\r\n    _a[\"no-app-id\" /* NO_APP_ID */] = 'The \"appId\" field is empty in the local Firebase config. Firebase Analytics requires this field to' +\r\n        'contain a valid app ID.',\r\n    _a);\r\nvar ERROR_FACTORY = new ErrorFactory('analytics', 'Analytics', ERRORS);\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Backoff factor for 503 errors, which we want to be conservative about\r\n * to avoid overloading servers. Each retry interval will be\r\n * BASE_INTERVAL_MILLIS * LONG_RETRY_FACTOR ^ retryCount, so the second one\r\n * will be ~30 seconds (with fuzzing).\r\n */\r\nvar LONG_RETRY_FACTOR = 30;\r\n/**\r\n * Base wait interval to multiplied by backoffFactor^backoffCount.\r\n */\r\nvar BASE_INTERVAL_MILLIS = 1000;\r\n/**\r\n * Stubbable retry data storage class.\r\n */\r\nvar RetryData = /** @class */ (function () {\r\n    function RetryData(throttleMetadata, intervalMillis) {\r\n        if (throttleMetadata === void 0) { throttleMetadata = {}; }\r\n        if (intervalMillis === void 0) { intervalMillis = BASE_INTERVAL_MILLIS; }\r\n        this.throttleMetadata = throttleMetadata;\r\n        this.intervalMillis = intervalMillis;\r\n    }\r\n    RetryData.prototype.getThrottleMetadata = function (appId) {\r\n        return this.throttleMetadata[appId];\r\n    };\r\n    RetryData.prototype.setThrottleMetadata = function (appId, metadata) {\r\n        this.throttleMetadata[appId] = metadata;\r\n    };\r\n    RetryData.prototype.deleteThrottleMetadata = function (appId) {\r\n        delete this.throttleMetadata[appId];\r\n    };\r\n    return RetryData;\r\n}());\r\nvar defaultRetryData = new RetryData();\r\n/**\r\n * Set GET request headers.\r\n * @param apiKey App API key.\r\n */\r\nfunction getHeaders(apiKey) {\r\n    return new Headers({\r\n        Accept: 'application/json',\r\n        'x-goog-api-key': apiKey\r\n    });\r\n}\r\n/**\r\n * Fetches dynamic config from backend.\r\n * @param app Firebase app to fetch config for.\r\n */\r\nfunction fetchDynamicConfig(appFields) {\r\n    var _a;\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var appId, apiKey, request, appUrl, response, errorMessage, jsonResponse;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0:\r\n                    appId = appFields.appId, apiKey = appFields.apiKey;\r\n                    request = {\r\n                        method: 'GET',\r\n                        headers: getHeaders(apiKey)\r\n                    };\r\n                    appUrl = DYNAMIC_CONFIG_URL.replace('{app-id}', appId);\r\n                    return [4 /*yield*/, fetch(appUrl, request)];\r\n                case 1:\r\n                    response = _b.sent();\r\n                    if (!(response.status !== 200 && response.status !== 304)) return [3 /*break*/, 6];\r\n                    errorMessage = '';\r\n                    _b.label = 2;\r\n                case 2:\r\n                    _b.trys.push([2, 4, , 5]);\r\n                    return [4 /*yield*/, response.json()];\r\n                case 3:\r\n                    jsonResponse = (_b.sent());\r\n                    if ((_a = jsonResponse.error) === null || _a === void 0 ? void 0 : _a.message) {\r\n                        errorMessage = jsonResponse.error.message;\r\n                    }\r\n                    return [3 /*break*/, 5];\r\n                case 4:\r\n                    _b.sent();\r\n                    return [3 /*break*/, 5];\r\n                case 5: throw ERROR_FACTORY.create(\"config-fetch-failed\" /* CONFIG_FETCH_FAILED */, {\r\n                    httpStatus: response.status,\r\n                    responseMessage: errorMessage\r\n                });\r\n                case 6: return [2 /*return*/, response.json()];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Fetches dynamic config from backend, retrying if failed.\r\n * @param app Firebase app to fetch config for.\r\n */\r\nfunction fetchDynamicConfigWithRetry(app, \r\n// retryData and timeoutMillis are parameterized to allow passing a different value for testing.\r\nretryData, timeoutMillis) {\r\n    if (retryData === void 0) { retryData = defaultRetryData; }\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var _a, appId, apiKey, measurementId, throttleMetadata, signal;\r\n        var _this = this;\r\n        return __generator(this, function (_b) {\r\n            _a = app.options, appId = _a.appId, apiKey = _a.apiKey, measurementId = _a.measurementId;\r\n            if (!appId) {\r\n                throw ERROR_FACTORY.create(\"no-app-id\" /* NO_APP_ID */);\r\n            }\r\n            if (!apiKey) {\r\n                if (measurementId) {\r\n                    return [2 /*return*/, {\r\n                            measurementId: measurementId,\r\n                            appId: appId\r\n                        }];\r\n                }\r\n                throw ERROR_FACTORY.create(\"no-api-key\" /* NO_API_KEY */);\r\n            }\r\n            throttleMetadata = retryData.getThrottleMetadata(appId) || {\r\n                backoffCount: 0,\r\n                throttleEndTimeMillis: Date.now()\r\n            };\r\n            signal = new AnalyticsAbortSignal();\r\n            setTimeout(function () { return __awaiter(_this, void 0, void 0, function () {\r\n                return __generator(this, function (_a) {\r\n                    // Note a very low delay, eg < 10ms, can elapse before listeners are initialized.\r\n                    signal.abort();\r\n                    return [2 /*return*/];\r\n                });\r\n            }); }, timeoutMillis !== undefined ? timeoutMillis : FETCH_TIMEOUT_MILLIS);\r\n            return [2 /*return*/, attemptFetchDynamicConfigWithRetry({ appId: appId, apiKey: apiKey, measurementId: measurementId }, throttleMetadata, signal, retryData)];\r\n        });\r\n    });\r\n}\r\n/**\r\n * Runs one retry attempt.\r\n * @param appFields Necessary app config fields.\r\n * @param throttleMetadata Ongoing metadata to determine throttling times.\r\n * @param signal Abort signal.\r\n */\r\nfunction attemptFetchDynamicConfigWithRetry(appFields, _a, signal, retryData // for testing\r\n) {\r\n    var throttleEndTimeMillis = _a.throttleEndTimeMillis, backoffCount = _a.backoffCount;\r\n    if (retryData === void 0) { retryData = defaultRetryData; }\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var appId, measurementId, e_1, response, e_2, backoffMillis, throttleMetadata;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0:\r\n                    appId = appFields.appId, measurementId = appFields.measurementId;\r\n                    _b.label = 1;\r\n                case 1:\r\n                    _b.trys.push([1, 3, , 4]);\r\n                    return [4 /*yield*/, setAbortableTimeout(signal, throttleEndTimeMillis)];\r\n                case 2:\r\n                    _b.sent();\r\n                    return [3 /*break*/, 4];\r\n                case 3:\r\n                    e_1 = _b.sent();\r\n                    if (measurementId) {\r\n                        logger.warn(\"Timed out fetching this Firebase app's measurement ID from the server.\" +\r\n                            (\" Falling back to the measurement ID \" + measurementId) +\r\n                            (\" provided in the \\\"measurementId\\\" field in the local Firebase config. [\" + e_1.message + \"]\"));\r\n                        return [2 /*return*/, { appId: appId, measurementId: measurementId }];\r\n                    }\r\n                    throw e_1;\r\n                case 4:\r\n                    _b.trys.push([4, 6, , 7]);\r\n                    return [4 /*yield*/, fetchDynamicConfig(appFields)];\r\n                case 5:\r\n                    response = _b.sent();\r\n                    // Note the SDK only clears throttle state if response is success or non-retriable.\r\n                    retryData.deleteThrottleMetadata(appId);\r\n                    return [2 /*return*/, response];\r\n                case 6:\r\n                    e_2 = _b.sent();\r\n                    if (!isRetriableError(e_2)) {\r\n                        retryData.deleteThrottleMetadata(appId);\r\n                        if (measurementId) {\r\n                            logger.warn(\"Failed to fetch this Firebase app's measurement ID from the server.\" +\r\n                                (\" Falling back to the measurement ID \" + measurementId) +\r\n                                (\" provided in the \\\"measurementId\\\" field in the local Firebase config. [\" + e_2.message + \"]\"));\r\n                            return [2 /*return*/, { appId: appId, measurementId: measurementId }];\r\n                        }\r\n                        else {\r\n                            throw e_2;\r\n                        }\r\n                    }\r\n                    backoffMillis = Number(e_2.customData.httpStatus) === 503\r\n                        ? calculateBackoffMillis(backoffCount, retryData.intervalMillis, LONG_RETRY_FACTOR)\r\n                        : calculateBackoffMillis(backoffCount, retryData.intervalMillis);\r\n                    throttleMetadata = {\r\n                        throttleEndTimeMillis: Date.now() + backoffMillis,\r\n                        backoffCount: backoffCount + 1\r\n                    };\r\n                    // Persists state.\r\n                    retryData.setThrottleMetadata(appId, throttleMetadata);\r\n                    logger.debug(\"Calling attemptFetch again in \" + backoffMillis + \" millis\");\r\n                    return [2 /*return*/, attemptFetchDynamicConfigWithRetry(appFields, throttleMetadata, signal, retryData)];\r\n                case 7: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Supports waiting on a backoff by:\r\n *\r\n * <ul>\r\n *   <li>Promisifying setTimeout, so we can set a timeout in our Promise chain</li>\r\n *   <li>Listening on a signal bus for abort events, just like the Fetch API</li>\r\n *   <li>Failing in the same way the Fetch API fails, so timing out a live request and a throttled\r\n *       request appear the same.</li>\r\n * </ul>\r\n *\r\n * <p>Visible for testing.\r\n */\r\nfunction setAbortableTimeout(signal, throttleEndTimeMillis) {\r\n    return new Promise(function (resolve, reject) {\r\n        // Derives backoff from given end time, normalizing negative numbers to zero.\r\n        var backoffMillis = Math.max(throttleEndTimeMillis - Date.now(), 0);\r\n        var timeout = setTimeout(resolve, backoffMillis);\r\n        // Adds listener, rather than sets onabort, because signal is a shared object.\r\n        signal.addEventListener(function () {\r\n            clearTimeout(timeout);\r\n            // If the request completes before this timeout, the rejection has no effect.\r\n            reject(ERROR_FACTORY.create(\"fetch-throttle\" /* FETCH_THROTTLE */, {\r\n                throttleEndTimeMillis: throttleEndTimeMillis\r\n            }));\r\n        });\r\n    });\r\n}\r\n/**\r\n * Returns true if the {@link Error} indicates a fetch request may succeed later.\r\n */\r\nfunction isRetriableError(e) {\r\n    if (!(e instanceof FirebaseError) || !e.customData) {\r\n        return false;\r\n    }\r\n    // Uses string index defined by ErrorData, which FirebaseError implements.\r\n    var httpStatus = Number(e.customData['httpStatus']);\r\n    return (httpStatus === 429 ||\r\n        httpStatus === 500 ||\r\n        httpStatus === 503 ||\r\n        httpStatus === 504);\r\n}\r\n/**\r\n * Shims a minimal AbortSignal (copied from Remote Config).\r\n *\r\n * <p>AbortController's AbortSignal conveniently decouples fetch timeout logic from other aspects\r\n * of networking, such as retries. Firebase doesn't use AbortController enough to justify a\r\n * polyfill recommendation, like we do with the Fetch API, but this minimal shim can easily be\r\n * swapped out if/when we do.\r\n */\r\nvar AnalyticsAbortSignal = /** @class */ (function () {\r\n    function AnalyticsAbortSignal() {\r\n        this.listeners = [];\r\n    }\r\n    AnalyticsAbortSignal.prototype.addEventListener = function (listener) {\r\n        this.listeners.push(listener);\r\n    };\r\n    AnalyticsAbortSignal.prototype.abort = function () {\r\n        this.listeners.forEach(function (listener) { return listener(); });\r\n    };\r\n    return AnalyticsAbortSignal;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction validateIndexedDB() {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var e_1;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    if (!!isIndexedDBAvailable()) return [3 /*break*/, 1];\r\n                    logger.warn(ERROR_FACTORY.create(\"indexeddb-unavailable\" /* INDEXEDDB_UNAVAILABLE */, {\r\n                        errorInfo: 'IndexedDB is not available in this environment.'\r\n                    }).message);\r\n                    return [2 /*return*/, false];\r\n                case 1:\r\n                    _a.trys.push([1, 3, , 4]);\r\n                    return [4 /*yield*/, validateIndexedDBOpenable()];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [3 /*break*/, 4];\r\n                case 3:\r\n                    e_1 = _a.sent();\r\n                    logger.warn(ERROR_FACTORY.create(\"indexeddb-unavailable\" /* INDEXEDDB_UNAVAILABLE */, {\r\n                        errorInfo: e_1\r\n                    }).message);\r\n                    return [2 /*return*/, false];\r\n                case 4: return [2 /*return*/, true];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Initialize the analytics instance in gtag.js by calling config command with fid.\r\n *\r\n * NOTE: We combine analytics initialization and setting fid together because we want fid to be\r\n * part of the `page_view` event that's sent during the initialization\r\n * @param app Firebase app\r\n * @param gtagCore The gtag function that's not wrapped.\r\n * @param dynamicConfigPromisesList Array of all dynamic config promises.\r\n * @param measurementIdToAppId Maps measurementID to appID.\r\n * @param installations FirebaseInstallations instance.\r\n *\r\n * @returns Measurement ID.\r\n */\r\nfunction initializeIds(app, dynamicConfigPromisesList, measurementIdToAppId, installations, gtagCore, dataLayerName) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var dynamicConfigPromise, fidPromise, _a, dynamicConfig, fid, configProperties;\r\n        var _b;\r\n        return __generator(this, function (_c) {\r\n            switch (_c.label) {\r\n                case 0:\r\n                    dynamicConfigPromise = fetchDynamicConfigWithRetry(app);\r\n                    // Once fetched, map measurementIds to appId, for ease of lookup in wrapped gtag function.\r\n                    dynamicConfigPromise\r\n                        .then(function (config) {\r\n                        measurementIdToAppId[config.measurementId] = config.appId;\r\n                        if (app.options.measurementId &&\r\n                            config.measurementId !== app.options.measurementId) {\r\n                            logger.warn(\"The measurement ID in the local Firebase config (\" + app.options.measurementId + \")\" +\r\n                                (\" does not match the measurement ID fetched from the server (\" + config.measurementId + \").\") +\r\n                                \" To ensure analytics events are always sent to the correct Analytics property,\" +\r\n                                \" update the\" +\r\n                                \" measurement ID field in the local config or remove it from the local config.\");\r\n                        }\r\n                    })\r\n                        .catch(function (e) { return logger.error(e); });\r\n                    // Add to list to track state of all dynamic config promises.\r\n                    dynamicConfigPromisesList.push(dynamicConfigPromise);\r\n                    fidPromise = validateIndexedDB().then(function (envIsValid) {\r\n                        if (envIsValid) {\r\n                            return installations.getId();\r\n                        }\r\n                        else {\r\n                            return undefined;\r\n                        }\r\n                    });\r\n                    return [4 /*yield*/, Promise.all([\r\n                            dynamicConfigPromise,\r\n                            fidPromise\r\n                        ])];\r\n                case 1:\r\n                    _a = _c.sent(), dynamicConfig = _a[0], fid = _a[1];\r\n                    // Detect if user has already put the gtag <script> tag on this page.\r\n                    if (!findGtagScriptOnPage()) {\r\n                        insertScriptTag(dataLayerName, dynamicConfig.measurementId);\r\n                    }\r\n                    // This command initializes gtag.js and only needs to be called once for the entire web app,\r\n                    // but since it is idempotent, we can call it multiple times.\r\n                    // We keep it together with other initialization logic for better code structure.\r\n                    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n                    gtagCore('js', new Date());\r\n                    configProperties = (_b = {},\r\n                        // guard against developers accidentally setting properties with prefix `firebase_`\r\n                        _b[ORIGIN_KEY] = 'firebase',\r\n                        _b.update = true,\r\n                        _b);\r\n                    if (fid != null) {\r\n                        configProperties[GA_FID_KEY] = fid;\r\n                    }\r\n                    // It should be the first config command called on this GA-ID\r\n                    // Initialize this GA-ID and set FID on it using the gtag config API.\r\n                    // Note: This will trigger a page_view event unless 'send_page_view' is set to false in\r\n                    // `configProperties`.\r\n                    gtagCore(GtagCommand.CONFIG, dynamicConfig.measurementId, configProperties);\r\n                    return [2 /*return*/, dynamicConfig.measurementId];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Maps appId to full initialization promise. Wrapped gtag calls must wait on\r\n * all or some of these, depending on the call's `send_to` param and the status\r\n * of the dynamic config fetches (see below).\r\n */\r\nvar initializationPromisesMap = {};\r\n/**\r\n * List of dynamic config fetch promises. In certain cases, wrapped gtag calls\r\n * wait on all these to be complete in order to determine if it can selectively\r\n * wait for only certain initialization (FID) promises or if it must wait for all.\r\n */\r\nvar dynamicConfigPromisesList = [];\r\n/**\r\n * Maps fetched measurementIds to appId. Populated when the app's dynamic config\r\n * fetch completes. If already populated, gtag config calls can use this to\r\n * selectively wait for only this app's initialization promise (FID) instead of all\r\n * initialization promises.\r\n */\r\nvar measurementIdToAppId = {};\r\n/**\r\n * Name for window global data layer array used by GA: defaults to 'dataLayer'.\r\n */\r\nvar dataLayerName = 'dataLayer';\r\n/**\r\n * Name for window global gtag function used by GA: defaults to 'gtag'.\r\n */\r\nvar gtagName = 'gtag';\r\n/**\r\n * Reproduction of standard gtag function or reference to existing\r\n * gtag function on window object.\r\n */\r\nvar gtagCoreFunction;\r\n/**\r\n * Wrapper around gtag function that ensures FID is sent with all\r\n * relevant event and config calls.\r\n */\r\nvar wrappedGtagFunction;\r\n/**\r\n * Flag to ensure page initialization steps (creation or wrapping of\r\n * dataLayer and gtag script) are only run once per page load.\r\n */\r\nvar globalInitDone = false;\r\n/**\r\n * For testing\r\n */\r\nfunction resetGlobalVars(newGlobalInitDone, newInitializationPromisesMap, newDynamicPromises) {\r\n    if (newGlobalInitDone === void 0) { newGlobalInitDone = false; }\r\n    if (newInitializationPromisesMap === void 0) { newInitializationPromisesMap = {}; }\r\n    if (newDynamicPromises === void 0) { newDynamicPromises = []; }\r\n    globalInitDone = newGlobalInitDone;\r\n    initializationPromisesMap = newInitializationPromisesMap;\r\n    dynamicConfigPromisesList = newDynamicPromises;\r\n    dataLayerName = 'dataLayer';\r\n    gtagName = 'gtag';\r\n}\r\n/**\r\n * For testing\r\n */\r\nfunction getGlobalVars() {\r\n    return {\r\n        initializationPromisesMap: initializationPromisesMap,\r\n        dynamicConfigPromisesList: dynamicConfigPromisesList\r\n    };\r\n}\r\n/**\r\n * This must be run before calling firebase.analytics() or it won't\r\n * have any effect.\r\n * @param options Custom gtag and dataLayer names.\r\n */\r\nfunction settings(options) {\r\n    if (globalInitDone) {\r\n        throw ERROR_FACTORY.create(\"already-initialized\" /* ALREADY_INITIALIZED */);\r\n    }\r\n    if (options.dataLayerName) {\r\n        dataLayerName = options.dataLayerName;\r\n    }\r\n    if (options.gtagName) {\r\n        gtagName = options.gtagName;\r\n    }\r\n}\r\n/**\r\n * Returns true if no environment mismatch is found.\r\n * If environment mismatches are found, throws an INVALID_ANALYTICS_CONTEXT\r\n * error that also lists details for each mismatch found.\r\n */\r\nfunction warnOnBrowserContextMismatch() {\r\n    var mismatchedEnvMessages = [];\r\n    if (isBrowserExtension()) {\r\n        mismatchedEnvMessages.push('This is a browser extension environment.');\r\n    }\r\n    if (!areCookiesEnabled()) {\r\n        mismatchedEnvMessages.push('Cookies are not available.');\r\n    }\r\n    if (mismatchedEnvMessages.length > 0) {\r\n        var details = mismatchedEnvMessages\r\n            .map(function (message, index) { return \"(\" + (index + 1) + \") \" + message; })\r\n            .join(' ');\r\n        var err = ERROR_FACTORY.create(\"invalid-analytics-context\" /* INVALID_ANALYTICS_CONTEXT */, {\r\n            errorInfo: details\r\n        });\r\n        logger.warn(err.message);\r\n    }\r\n}\r\nfunction factory(app, installations) {\r\n    warnOnBrowserContextMismatch();\r\n    var appId = app.options.appId;\r\n    if (!appId) {\r\n        throw ERROR_FACTORY.create(\"no-app-id\" /* NO_APP_ID */);\r\n    }\r\n    if (!app.options.apiKey) {\r\n        if (app.options.measurementId) {\r\n            logger.warn(\"The \\\"apiKey\\\" field is empty in the local Firebase config. This is needed to fetch the latest\" +\r\n                (\" measurement ID for this Firebase app. Falling back to the measurement ID \" + app.options.measurementId) +\r\n                \" provided in the \\\"measurementId\\\" field in the local Firebase config.\");\r\n        }\r\n        else {\r\n            throw ERROR_FACTORY.create(\"no-api-key\" /* NO_API_KEY */);\r\n        }\r\n    }\r\n    if (initializationPromisesMap[appId] != null) {\r\n        throw ERROR_FACTORY.create(\"already-exists\" /* ALREADY_EXISTS */, {\r\n            id: appId\r\n        });\r\n    }\r\n    if (!globalInitDone) {\r\n        // Steps here should only be done once per page: creation or wrapping\r\n        // of dataLayer and global gtag function.\r\n        getOrCreateDataLayer(dataLayerName);\r\n        var _a = wrapOrCreateGtag(initializationPromisesMap, dynamicConfigPromisesList, measurementIdToAppId, dataLayerName, gtagName), wrappedGtag = _a.wrappedGtag, gtagCore = _a.gtagCore;\r\n        wrappedGtagFunction = wrappedGtag;\r\n        gtagCoreFunction = gtagCore;\r\n        globalInitDone = true;\r\n    }\r\n    // Async but non-blocking.\r\n    // This map reflects the completion state of all promises for each appId.\r\n    initializationPromisesMap[appId] = initializeIds(app, dynamicConfigPromisesList, measurementIdToAppId, installations, gtagCoreFunction, dataLayerName);\r\n    var analyticsInstance = {\r\n        app: app,\r\n        // Public methods return void for API simplicity and to better match gtag,\r\n        // while internal implementations return promises.\r\n        logEvent: function (eventName, eventParams, options) {\r\n            logEvent(wrappedGtagFunction, initializationPromisesMap[appId], eventName, eventParams, options).catch(function (e) { return logger.error(e); });\r\n        },\r\n        setCurrentScreen: function (screenName, options) {\r\n            setCurrentScreen(wrappedGtagFunction, initializationPromisesMap[appId], screenName, options).catch(function (e) { return logger.error(e); });\r\n        },\r\n        setUserId: function (id, options) {\r\n            setUserId(wrappedGtagFunction, initializationPromisesMap[appId], id, options).catch(function (e) { return logger.error(e); });\r\n        },\r\n        setUserProperties: function (properties, options) {\r\n            setUserProperties(wrappedGtagFunction, initializationPromisesMap[appId], properties, options).catch(function (e) { return logger.error(e); });\r\n        },\r\n        setAnalyticsCollectionEnabled: function (enabled) {\r\n            setAnalyticsCollectionEnabled(initializationPromisesMap[appId], enabled).catch(function (e) { return logger.error(e); });\r\n        },\r\n        INTERNAL: {\r\n            delete: function () {\r\n                delete initializationPromisesMap[appId];\r\n                return Promise.resolve();\r\n            }\r\n        }\r\n    };\r\n    return analyticsInstance;\r\n}\n\nvar name = \"@firebase/analytics\";\nvar version = \"0.6.18\";\n\n/**\r\n * Type constant for Firebase Analytics.\r\n */\r\nvar ANALYTICS_TYPE = 'analytics';\r\nfunction registerAnalytics(instance) {\r\n    instance.INTERNAL.registerComponent(new Component(ANALYTICS_TYPE, function (container) {\r\n        // getImmediate for FirebaseApp will always succeed\r\n        var app = container.getProvider('app').getImmediate();\r\n        var installations = container\r\n            .getProvider('installations')\r\n            .getImmediate();\r\n        return factory(app, installations);\r\n    }, \"PUBLIC\" /* PUBLIC */).setServiceProps({\r\n        settings: settings,\r\n        EventName: EventName,\r\n        isSupported: isSupported\r\n    }));\r\n    instance.INTERNAL.registerComponent(new Component('analytics-internal', internalFactory, \"PRIVATE\" /* PRIVATE */));\r\n    instance.registerVersion(name, version);\r\n    function internalFactory(container) {\r\n        try {\r\n            var analytics = container.getProvider(ANALYTICS_TYPE).getImmediate();\r\n            return {\r\n                logEvent: analytics.logEvent\r\n            };\r\n        }\r\n        catch (e) {\r\n            throw ERROR_FACTORY.create(\"interop-component-reg-failed\" /* INTEROP_COMPONENT_REG_FAILED */, {\r\n                reason: e\r\n            });\r\n        }\r\n    }\r\n}\r\nregisterAnalytics(firebase);\r\n/**\r\n * this is a public static method provided to users that wraps four different checks:\r\n *\r\n * 1. check if it's not a browser extension environment.\r\n * 1. check if cookie is enabled in current browser.\r\n * 3. check if IndexedDB is supported by the browser environment.\r\n * 4. check if the current browser context is valid for using IndexedDB.\r\n *\r\n */\r\nfunction isSupported() {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var isDBOpenable;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    if (isBrowserExtension()) {\r\n                        return [2 /*return*/, false];\r\n                    }\r\n                    if (!areCookiesEnabled()) {\r\n                        return [2 /*return*/, false];\r\n                    }\r\n                    if (!isIndexedDBAvailable()) {\r\n                        return [2 /*return*/, false];\r\n                    }\r\n                    _a.label = 1;\r\n                case 1:\r\n                    _a.trys.push([1, 3, , 4]);\r\n                    return [4 /*yield*/, validateIndexedDBOpenable()];\r\n                case 2:\r\n                    isDBOpenable = _a.sent();\r\n                    return [2 /*return*/, isDBOpenable];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [2 /*return*/, false];\r\n                case 4: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\n\nexport { factory, getGlobalVars, registerAnalytics, resetGlobalVars, settings };\n//# sourceMappingURL=index.esm.js.map\n","import '@firebase/analytics';\n//# sourceMappingURL=index.esm.js.map\n","import firebase from '@firebase/app';\nimport { Component } from '@firebase/component';\nimport { __awaiter, __generator, __spreadArray, __read, __values, __assign } from 'tslib';\nimport { ErrorFactory, FirebaseError } from '@firebase/util';\nimport { openDb } from 'idb';\n\nvar name = \"@firebase/installations\";\nvar version = \"0.4.32\";\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar PENDING_TIMEOUT_MS = 10000;\r\nvar PACKAGE_VERSION = \"w:\" + version;\r\nvar INTERNAL_AUTH_VERSION = 'FIS_v2';\r\nvar INSTALLATIONS_API_URL = 'https://firebaseinstallations.googleapis.com/v1';\r\nvar TOKEN_EXPIRATION_BUFFER = 60 * 60 * 1000; // One hour\r\nvar SERVICE = 'installations';\r\nvar SERVICE_NAME = 'Installations';\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar _a;\r\nvar ERROR_DESCRIPTION_MAP = (_a = {},\r\n    _a[\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */] = 'Missing App configuration value: \"{$valueName}\"',\r\n    _a[\"not-registered\" /* NOT_REGISTERED */] = 'Firebase Installation is not registered.',\r\n    _a[\"installation-not-found\" /* INSTALLATION_NOT_FOUND */] = 'Firebase Installation not found.',\r\n    _a[\"request-failed\" /* REQUEST_FAILED */] = '{$requestName} request failed with error \"{$serverCode} {$serverStatus}: {$serverMessage}\"',\r\n    _a[\"app-offline\" /* APP_OFFLINE */] = 'Could not process request. Application offline.',\r\n    _a[\"delete-pending-registration\" /* DELETE_PENDING_REGISTRATION */] = \"Can't delete installation while there is a pending registration request.\",\r\n    _a);\r\nvar ERROR_FACTORY = new ErrorFactory(SERVICE, SERVICE_NAME, ERROR_DESCRIPTION_MAP);\r\n/** Returns true if error is a FirebaseError that is based on an error from the server. */\r\nfunction isServerError(error) {\r\n    return (error instanceof FirebaseError &&\r\n        error.code.includes(\"request-failed\" /* REQUEST_FAILED */));\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getInstallationsEndpoint(_a) {\r\n    var projectId = _a.projectId;\r\n    return INSTALLATIONS_API_URL + \"/projects/\" + projectId + \"/installations\";\r\n}\r\nfunction extractAuthTokenInfoFromResponse(response) {\r\n    return {\r\n        token: response.token,\r\n        requestStatus: 2 /* COMPLETED */,\r\n        expiresIn: getExpiresInFromResponseExpiresIn(response.expiresIn),\r\n        creationTime: Date.now()\r\n    };\r\n}\r\nfunction getErrorFromResponse(requestName, response) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var responseJson, errorData;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, response.json()];\r\n                case 1:\r\n                    responseJson = _a.sent();\r\n                    errorData = responseJson.error;\r\n                    return [2 /*return*/, ERROR_FACTORY.create(\"request-failed\" /* REQUEST_FAILED */, {\r\n                            requestName: requestName,\r\n                            serverCode: errorData.code,\r\n                            serverMessage: errorData.message,\r\n                            serverStatus: errorData.status\r\n                        })];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getHeaders(_a) {\r\n    var apiKey = _a.apiKey;\r\n    return new Headers({\r\n        'Content-Type': 'application/json',\r\n        Accept: 'application/json',\r\n        'x-goog-api-key': apiKey\r\n    });\r\n}\r\nfunction getHeadersWithAuth(appConfig, _a) {\r\n    var refreshToken = _a.refreshToken;\r\n    var headers = getHeaders(appConfig);\r\n    headers.append('Authorization', getAuthorizationHeader(refreshToken));\r\n    return headers;\r\n}\r\n/**\r\n * Calls the passed in fetch wrapper and returns the response.\r\n * If the returned response has a status of 5xx, re-runs the function once and\r\n * returns the response.\r\n */\r\nfunction retryIfServerError(fn) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var result;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, fn()];\r\n                case 1:\r\n                    result = _a.sent();\r\n                    if (result.status >= 500 && result.status < 600) {\r\n                        // Internal Server Error. Retry request.\r\n                        return [2 /*return*/, fn()];\r\n                    }\r\n                    return [2 /*return*/, result];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getExpiresInFromResponseExpiresIn(responseExpiresIn) {\r\n    // This works because the server will never respond with fractions of a second.\r\n    return Number(responseExpiresIn.replace('s', '000'));\r\n}\r\nfunction getAuthorizationHeader(refreshToken) {\r\n    return INTERNAL_AUTH_VERSION + \" \" + refreshToken;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction createInstallationRequest(appConfig, _a) {\r\n    var fid = _a.fid;\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var endpoint, headers, body, request, response, responseValue, registeredInstallationEntry;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0:\r\n                    endpoint = getInstallationsEndpoint(appConfig);\r\n                    headers = getHeaders(appConfig);\r\n                    body = {\r\n                        fid: fid,\r\n                        authVersion: INTERNAL_AUTH_VERSION,\r\n                        appId: appConfig.appId,\r\n                        sdkVersion: PACKAGE_VERSION\r\n                    };\r\n                    request = {\r\n                        method: 'POST',\r\n                        headers: headers,\r\n                        body: JSON.stringify(body)\r\n                    };\r\n                    return [4 /*yield*/, retryIfServerError(function () { return fetch(endpoint, request); })];\r\n                case 1:\r\n                    response = _b.sent();\r\n                    if (!response.ok) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, response.json()];\r\n                case 2:\r\n                    responseValue = _b.sent();\r\n                    registeredInstallationEntry = {\r\n                        fid: responseValue.fid || fid,\r\n                        registrationStatus: 2 /* COMPLETED */,\r\n                        refreshToken: responseValue.refreshToken,\r\n                        authToken: extractAuthTokenInfoFromResponse(responseValue.authToken)\r\n                    };\r\n                    return [2 /*return*/, registeredInstallationEntry];\r\n                case 3: return [4 /*yield*/, getErrorFromResponse('Create Installation', response)];\r\n                case 4: throw _b.sent();\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/** Returns a promise that resolves after given time passes. */\r\nfunction sleep(ms) {\r\n    return new Promise(function (resolve) {\r\n        setTimeout(resolve, ms);\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction bufferToBase64UrlSafe(array) {\r\n    var b64 = btoa(String.fromCharCode.apply(String, __spreadArray([], __read(array))));\r\n    return b64.replace(/\\+/g, '-').replace(/\\//g, '_');\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar VALID_FID_PATTERN = /^[cdef][\\w-]{21}$/;\r\nvar INVALID_FID = '';\r\n/**\r\n * Generates a new FID using random values from Web Crypto API.\r\n * Returns an empty string if FID generation fails for any reason.\r\n */\r\nfunction generateFid() {\r\n    try {\r\n        // A valid FID has exactly 22 base64 characters, which is 132 bits, or 16.5\r\n        // bytes. our implementation generates a 17 byte array instead.\r\n        var fidByteArray = new Uint8Array(17);\r\n        var crypto_1 = self.crypto || self.msCrypto;\r\n        crypto_1.getRandomValues(fidByteArray);\r\n        // Replace the first 4 random bits with the constant FID header of 0b0111.\r\n        fidByteArray[0] = 112 + (fidByteArray[0] % 16);\r\n        var fid = encode(fidByteArray);\r\n        return VALID_FID_PATTERN.test(fid) ? fid : INVALID_FID;\r\n    }\r\n    catch (_a) {\r\n        // FID generation errored\r\n        return INVALID_FID;\r\n    }\r\n}\r\n/** Converts a FID Uint8Array to a base64 string representation. */\r\nfunction encode(fidByteArray) {\r\n    var b64String = bufferToBase64UrlSafe(fidByteArray);\r\n    // Remove the 23rd character that was added because of the extra 4 bits at the\r\n    // end of our 17 byte array, and the '=' padding.\r\n    return b64String.substr(0, 22);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/** Returns a string key that can be used to identify the app. */\r\nfunction getKey(appConfig) {\r\n    return appConfig.appName + \"!\" + appConfig.appId;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar fidChangeCallbacks = new Map();\r\n/**\r\n * Calls the onIdChange callbacks with the new FID value, and broadcasts the\r\n * change to other tabs.\r\n */\r\nfunction fidChanged(appConfig, fid) {\r\n    var key = getKey(appConfig);\r\n    callFidChangeCallbacks(key, fid);\r\n    broadcastFidChange(key, fid);\r\n}\r\nfunction addCallback(appConfig, callback) {\r\n    // Open the broadcast channel if it's not already open,\r\n    // to be able to listen to change events from other tabs.\r\n    getBroadcastChannel();\r\n    var key = getKey(appConfig);\r\n    var callbackSet = fidChangeCallbacks.get(key);\r\n    if (!callbackSet) {\r\n        callbackSet = new Set();\r\n        fidChangeCallbacks.set(key, callbackSet);\r\n    }\r\n    callbackSet.add(callback);\r\n}\r\nfunction removeCallback(appConfig, callback) {\r\n    var key = getKey(appConfig);\r\n    var callbackSet = fidChangeCallbacks.get(key);\r\n    if (!callbackSet) {\r\n        return;\r\n    }\r\n    callbackSet.delete(callback);\r\n    if (callbackSet.size === 0) {\r\n        fidChangeCallbacks.delete(key);\r\n    }\r\n    // Close broadcast channel if there are no more callbacks.\r\n    closeBroadcastChannel();\r\n}\r\nfunction callFidChangeCallbacks(key, fid) {\r\n    var e_1, _a;\r\n    var callbacks = fidChangeCallbacks.get(key);\r\n    if (!callbacks) {\r\n        return;\r\n    }\r\n    try {\r\n        for (var callbacks_1 = __values(callbacks), callbacks_1_1 = callbacks_1.next(); !callbacks_1_1.done; callbacks_1_1 = callbacks_1.next()) {\r\n            var callback = callbacks_1_1.value;\r\n            callback(fid);\r\n        }\r\n    }\r\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\r\n    finally {\r\n        try {\r\n            if (callbacks_1_1 && !callbacks_1_1.done && (_a = callbacks_1.return)) _a.call(callbacks_1);\r\n        }\r\n        finally { if (e_1) throw e_1.error; }\r\n    }\r\n}\r\nfunction broadcastFidChange(key, fid) {\r\n    var channel = getBroadcastChannel();\r\n    if (channel) {\r\n        channel.postMessage({ key: key, fid: fid });\r\n    }\r\n    closeBroadcastChannel();\r\n}\r\nvar broadcastChannel = null;\r\n/** Opens and returns a BroadcastChannel if it is supported by the browser. */\r\nfunction getBroadcastChannel() {\r\n    if (!broadcastChannel && 'BroadcastChannel' in self) {\r\n        broadcastChannel = new BroadcastChannel('[Firebase] FID Change');\r\n        broadcastChannel.onmessage = function (e) {\r\n            callFidChangeCallbacks(e.data.key, e.data.fid);\r\n        };\r\n    }\r\n    return broadcastChannel;\r\n}\r\nfunction closeBroadcastChannel() {\r\n    if (fidChangeCallbacks.size === 0 && broadcastChannel) {\r\n        broadcastChannel.close();\r\n        broadcastChannel = null;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar DATABASE_NAME = 'firebase-installations-database';\r\nvar DATABASE_VERSION = 1;\r\nvar OBJECT_STORE_NAME = 'firebase-installations-store';\r\nvar dbPromise = null;\r\nfunction getDbPromise() {\r\n    if (!dbPromise) {\r\n        dbPromise = openDb(DATABASE_NAME, DATABASE_VERSION, function (upgradeDB) {\r\n            // We don't use 'break' in this switch statement, the fall-through\r\n            // behavior is what we want, because if there are multiple versions between\r\n            // the old version and the current version, we want ALL the migrations\r\n            // that correspond to those versions to run, not only the last one.\r\n            // eslint-disable-next-line default-case\r\n            switch (upgradeDB.oldVersion) {\r\n                case 0:\r\n                    upgradeDB.createObjectStore(OBJECT_STORE_NAME);\r\n            }\r\n        });\r\n    }\r\n    return dbPromise;\r\n}\r\n/** Assigns or overwrites the record for the given key with the given value. */\r\nfunction set(appConfig, value) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var key, db, tx, objectStore, oldValue;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(appConfig);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    objectStore = tx.objectStore(OBJECT_STORE_NAME);\r\n                    return [4 /*yield*/, objectStore.get(key)];\r\n                case 2:\r\n                    oldValue = _a.sent();\r\n                    return [4 /*yield*/, objectStore.put(value, key)];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, tx.complete];\r\n                case 4:\r\n                    _a.sent();\r\n                    if (!oldValue || oldValue.fid !== value.fid) {\r\n                        fidChanged(appConfig, value.fid);\r\n                    }\r\n                    return [2 /*return*/, value];\r\n            }\r\n        });\r\n    });\r\n}\r\n/** Removes record(s) from the objectStore that match the given key. */\r\nfunction remove(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var key, db, tx;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(appConfig);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    return [4 /*yield*/, tx.objectStore(OBJECT_STORE_NAME).delete(key)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, tx.complete];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Atomically updates a record with the result of updateFn, which gets\r\n * called with the current value. If newValue is undefined, the record is\r\n * deleted instead.\r\n * @return Updated value\r\n */\r\nfunction update(appConfig, updateFn) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var key, db, tx, store, oldValue, newValue;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(appConfig);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    store = tx.objectStore(OBJECT_STORE_NAME);\r\n                    return [4 /*yield*/, store.get(key)];\r\n                case 2:\r\n                    oldValue = _a.sent();\r\n                    newValue = updateFn(oldValue);\r\n                    if (!(newValue === undefined)) return [3 /*break*/, 4];\r\n                    return [4 /*yield*/, store.delete(key)];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [3 /*break*/, 6];\r\n                case 4: return [4 /*yield*/, store.put(newValue, key)];\r\n                case 5:\r\n                    _a.sent();\r\n                    _a.label = 6;\r\n                case 6: return [4 /*yield*/, tx.complete];\r\n                case 7:\r\n                    _a.sent();\r\n                    if (newValue && (!oldValue || oldValue.fid !== newValue.fid)) {\r\n                        fidChanged(appConfig, newValue.fid);\r\n                    }\r\n                    return [2 /*return*/, newValue];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Updates and returns the InstallationEntry from the database.\r\n * Also triggers a registration request if it is necessary and possible.\r\n */\r\nfunction getInstallationEntry(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var registrationPromise, installationEntry;\r\n        var _a;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, update(appConfig, function (oldEntry) {\r\n                        var installationEntry = updateOrCreateInstallationEntry(oldEntry);\r\n                        var entryWithPromise = triggerRegistrationIfNecessary(appConfig, installationEntry);\r\n                        registrationPromise = entryWithPromise.registrationPromise;\r\n                        return entryWithPromise.installationEntry;\r\n                    })];\r\n                case 1:\r\n                    installationEntry = _b.sent();\r\n                    if (!(installationEntry.fid === INVALID_FID)) return [3 /*break*/, 3];\r\n                    _a = {};\r\n                    return [4 /*yield*/, registrationPromise];\r\n                case 2: \r\n                // FID generation failed. Waiting for the FID from the server.\r\n                return [2 /*return*/, (_a.installationEntry = _b.sent(), _a)];\r\n                case 3: return [2 /*return*/, {\r\n                        installationEntry: installationEntry,\r\n                        registrationPromise: registrationPromise\r\n                    }];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Creates a new Installation Entry if one does not exist.\r\n * Also clears timed out pending requests.\r\n */\r\nfunction updateOrCreateInstallationEntry(oldEntry) {\r\n    var entry = oldEntry || {\r\n        fid: generateFid(),\r\n        registrationStatus: 0 /* NOT_STARTED */\r\n    };\r\n    return clearTimedOutRequest(entry);\r\n}\r\n/**\r\n * If the Firebase Installation is not registered yet, this will trigger the\r\n * registration and return an InProgressInstallationEntry.\r\n *\r\n * If registrationPromise does not exist, the installationEntry is guaranteed\r\n * to be registered.\r\n */\r\nfunction triggerRegistrationIfNecessary(appConfig, installationEntry) {\r\n    if (installationEntry.registrationStatus === 0 /* NOT_STARTED */) {\r\n        if (!navigator.onLine) {\r\n            // Registration required but app is offline.\r\n            var registrationPromiseWithError = Promise.reject(ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */));\r\n            return {\r\n                installationEntry: installationEntry,\r\n                registrationPromise: registrationPromiseWithError\r\n            };\r\n        }\r\n        // Try registering. Change status to IN_PROGRESS.\r\n        var inProgressEntry = {\r\n            fid: installationEntry.fid,\r\n            registrationStatus: 1 /* IN_PROGRESS */,\r\n            registrationTime: Date.now()\r\n        };\r\n        var registrationPromise = registerInstallation(appConfig, inProgressEntry);\r\n        return { installationEntry: inProgressEntry, registrationPromise: registrationPromise };\r\n    }\r\n    else if (installationEntry.registrationStatus === 1 /* IN_PROGRESS */) {\r\n        return {\r\n            installationEntry: installationEntry,\r\n            registrationPromise: waitUntilFidRegistration(appConfig)\r\n        };\r\n    }\r\n    else {\r\n        return { installationEntry: installationEntry };\r\n    }\r\n}\r\n/** This will be executed only once for each new Firebase Installation. */\r\nfunction registerInstallation(appConfig, installationEntry) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var registeredInstallationEntry, e_1;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    _a.trys.push([0, 2, , 7]);\r\n                    return [4 /*yield*/, createInstallationRequest(appConfig, installationEntry)];\r\n                case 1:\r\n                    registeredInstallationEntry = _a.sent();\r\n                    return [2 /*return*/, set(appConfig, registeredInstallationEntry)];\r\n                case 2:\r\n                    e_1 = _a.sent();\r\n                    if (!(isServerError(e_1) && e_1.customData.serverCode === 409)) return [3 /*break*/, 4];\r\n                    // Server returned a \"FID can not be used\" error.\r\n                    // Generate a new ID next time.\r\n                    return [4 /*yield*/, remove(appConfig)];\r\n                case 3:\r\n                    // Server returned a \"FID can not be used\" error.\r\n                    // Generate a new ID next time.\r\n                    _a.sent();\r\n                    return [3 /*break*/, 6];\r\n                case 4: \r\n                // Registration failed. Set FID as not registered.\r\n                return [4 /*yield*/, set(appConfig, {\r\n                        fid: installationEntry.fid,\r\n                        registrationStatus: 0 /* NOT_STARTED */\r\n                    })];\r\n                case 5:\r\n                    // Registration failed. Set FID as not registered.\r\n                    _a.sent();\r\n                    _a.label = 6;\r\n                case 6: throw e_1;\r\n                case 7: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/** Call if FID registration is pending in another request. */\r\nfunction waitUntilFidRegistration(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var entry, _a, installationEntry, registrationPromise;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, updateInstallationRequest(appConfig)];\r\n                case 1:\r\n                    entry = _b.sent();\r\n                    _b.label = 2;\r\n                case 2:\r\n                    if (!(entry.registrationStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 5];\r\n                    // createInstallation request still in progress.\r\n                    return [4 /*yield*/, sleep(100)];\r\n                case 3:\r\n                    // createInstallation request still in progress.\r\n                    _b.sent();\r\n                    return [4 /*yield*/, updateInstallationRequest(appConfig)];\r\n                case 4:\r\n                    entry = _b.sent();\r\n                    return [3 /*break*/, 2];\r\n                case 5:\r\n                    if (!(entry.registrationStatus === 0 /* NOT_STARTED */)) return [3 /*break*/, 7];\r\n                    return [4 /*yield*/, getInstallationEntry(appConfig)];\r\n                case 6:\r\n                    _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\r\n                    if (registrationPromise) {\r\n                        return [2 /*return*/, registrationPromise];\r\n                    }\r\n                    else {\r\n                        // if there is no registrationPromise, entry is registered.\r\n                        return [2 /*return*/, installationEntry];\r\n                    }\r\n                case 7: return [2 /*return*/, entry];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Called only if there is a CreateInstallation request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * CreateInstallation request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\r\nfunction updateInstallationRequest(appConfig) {\r\n    return update(appConfig, function (oldEntry) {\r\n        if (!oldEntry) {\r\n            throw ERROR_FACTORY.create(\"installation-not-found\" /* INSTALLATION_NOT_FOUND */);\r\n        }\r\n        return clearTimedOutRequest(oldEntry);\r\n    });\r\n}\r\nfunction clearTimedOutRequest(entry) {\r\n    if (hasInstallationRequestTimedOut(entry)) {\r\n        return {\r\n            fid: entry.fid,\r\n            registrationStatus: 0 /* NOT_STARTED */\r\n        };\r\n    }\r\n    return entry;\r\n}\r\nfunction hasInstallationRequestTimedOut(installationEntry) {\r\n    return (installationEntry.registrationStatus === 1 /* IN_PROGRESS */ &&\r\n        installationEntry.registrationTime + PENDING_TIMEOUT_MS < Date.now());\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction generateAuthTokenRequest(_a, installationEntry) {\r\n    var appConfig = _a.appConfig, platformLoggerProvider = _a.platformLoggerProvider;\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var endpoint, headers, platformLogger, body, request, response, responseValue, completedAuthToken;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0:\r\n                    endpoint = getGenerateAuthTokenEndpoint(appConfig, installationEntry);\r\n                    headers = getHeadersWithAuth(appConfig, installationEntry);\r\n                    platformLogger = platformLoggerProvider.getImmediate({\r\n                        optional: true\r\n                    });\r\n                    if (platformLogger) {\r\n                        headers.append('x-firebase-client', platformLogger.getPlatformInfoString());\r\n                    }\r\n                    body = {\r\n                        installation: {\r\n                            sdkVersion: PACKAGE_VERSION\r\n                        }\r\n                    };\r\n                    request = {\r\n                        method: 'POST',\r\n                        headers: headers,\r\n                        body: JSON.stringify(body)\r\n                    };\r\n                    return [4 /*yield*/, retryIfServerError(function () { return fetch(endpoint, request); })];\r\n                case 1:\r\n                    response = _b.sent();\r\n                    if (!response.ok) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, response.json()];\r\n                case 2:\r\n                    responseValue = _b.sent();\r\n                    completedAuthToken = extractAuthTokenInfoFromResponse(responseValue);\r\n                    return [2 /*return*/, completedAuthToken];\r\n                case 3: return [4 /*yield*/, getErrorFromResponse('Generate Auth Token', response)];\r\n                case 4: throw _b.sent();\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getGenerateAuthTokenEndpoint(appConfig, _a) {\r\n    var fid = _a.fid;\r\n    return getInstallationsEndpoint(appConfig) + \"/\" + fid + \"/authTokens:generate\";\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns a valid authentication token for the installation. Generates a new\r\n * token if one doesn't exist, is expired or about to expire.\r\n *\r\n * Should only be called if the Firebase Installation is registered.\r\n */\r\nfunction refreshAuthToken(dependencies, forceRefresh) {\r\n    if (forceRefresh === void 0) { forceRefresh = false; }\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var tokenPromise, entry, authToken, _a;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, update(dependencies.appConfig, function (oldEntry) {\r\n                        if (!isEntryRegistered(oldEntry)) {\r\n                            throw ERROR_FACTORY.create(\"not-registered\" /* NOT_REGISTERED */);\r\n                        }\r\n                        var oldAuthToken = oldEntry.authToken;\r\n                        if (!forceRefresh && isAuthTokenValid(oldAuthToken)) {\r\n                            // There is a valid token in the DB.\r\n                            return oldEntry;\r\n                        }\r\n                        else if (oldAuthToken.requestStatus === 1 /* IN_PROGRESS */) {\r\n                            // There already is a token request in progress.\r\n                            tokenPromise = waitUntilAuthTokenRequest(dependencies, forceRefresh);\r\n                            return oldEntry;\r\n                        }\r\n                        else {\r\n                            // No token or token expired.\r\n                            if (!navigator.onLine) {\r\n                                throw ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */);\r\n                            }\r\n                            var inProgressEntry = makeAuthTokenRequestInProgressEntry(oldEntry);\r\n                            tokenPromise = fetchAuthTokenFromServer(dependencies, inProgressEntry);\r\n                            return inProgressEntry;\r\n                        }\r\n                    })];\r\n                case 1:\r\n                    entry = _b.sent();\r\n                    if (!tokenPromise) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, tokenPromise];\r\n                case 2:\r\n                    _a = _b.sent();\r\n                    return [3 /*break*/, 4];\r\n                case 3:\r\n                    _a = entry.authToken;\r\n                    _b.label = 4;\r\n                case 4:\r\n                    authToken = _a;\r\n                    return [2 /*return*/, authToken];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Call only if FID is registered and Auth Token request is in progress.\r\n *\r\n * Waits until the current pending request finishes. If the request times out,\r\n * tries once in this thread as well.\r\n */\r\nfunction waitUntilAuthTokenRequest(dependencies, forceRefresh) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var entry, authToken;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, updateAuthTokenRequest(dependencies.appConfig)];\r\n                case 1:\r\n                    entry = _a.sent();\r\n                    _a.label = 2;\r\n                case 2:\r\n                    if (!(entry.authToken.requestStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 5];\r\n                    // generateAuthToken still in progress.\r\n                    return [4 /*yield*/, sleep(100)];\r\n                case 3:\r\n                    // generateAuthToken still in progress.\r\n                    _a.sent();\r\n                    return [4 /*yield*/, updateAuthTokenRequest(dependencies.appConfig)];\r\n                case 4:\r\n                    entry = _a.sent();\r\n                    return [3 /*break*/, 2];\r\n                case 5:\r\n                    authToken = entry.authToken;\r\n                    if (authToken.requestStatus === 0 /* NOT_STARTED */) {\r\n                        // The request timed out or failed in a different call. Try again.\r\n                        return [2 /*return*/, refreshAuthToken(dependencies, forceRefresh)];\r\n                    }\r\n                    else {\r\n                        return [2 /*return*/, authToken];\r\n                    }\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Called only if there is a GenerateAuthToken request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * GenerateAuthToken request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\r\nfunction updateAuthTokenRequest(appConfig) {\r\n    return update(appConfig, function (oldEntry) {\r\n        if (!isEntryRegistered(oldEntry)) {\r\n            throw ERROR_FACTORY.create(\"not-registered\" /* NOT_REGISTERED */);\r\n        }\r\n        var oldAuthToken = oldEntry.authToken;\r\n        if (hasAuthTokenRequestTimedOut(oldAuthToken)) {\r\n            return __assign(__assign({}, oldEntry), { authToken: { requestStatus: 0 /* NOT_STARTED */ } });\r\n        }\r\n        return oldEntry;\r\n    });\r\n}\r\nfunction fetchAuthTokenFromServer(dependencies, installationEntry) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var authToken, updatedInstallationEntry, e_1, updatedInstallationEntry;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    _a.trys.push([0, 3, , 8]);\r\n                    return [4 /*yield*/, generateAuthTokenRequest(dependencies, installationEntry)];\r\n                case 1:\r\n                    authToken = _a.sent();\r\n                    updatedInstallationEntry = __assign(__assign({}, installationEntry), { authToken: authToken });\r\n                    return [4 /*yield*/, set(dependencies.appConfig, updatedInstallationEntry)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [2 /*return*/, authToken];\r\n                case 3:\r\n                    e_1 = _a.sent();\r\n                    if (!(isServerError(e_1) &&\r\n                        (e_1.customData.serverCode === 401 || e_1.customData.serverCode === 404))) return [3 /*break*/, 5];\r\n                    // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\r\n                    // Generate a new ID next time.\r\n                    return [4 /*yield*/, remove(dependencies.appConfig)];\r\n                case 4:\r\n                    // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\r\n                    // Generate a new ID next time.\r\n                    _a.sent();\r\n                    return [3 /*break*/, 7];\r\n                case 5:\r\n                    updatedInstallationEntry = __assign(__assign({}, installationEntry), { authToken: { requestStatus: 0 /* NOT_STARTED */ } });\r\n                    return [4 /*yield*/, set(dependencies.appConfig, updatedInstallationEntry)];\r\n                case 6:\r\n                    _a.sent();\r\n                    _a.label = 7;\r\n                case 7: throw e_1;\r\n                case 8: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction isEntryRegistered(installationEntry) {\r\n    return (installationEntry !== undefined &&\r\n        installationEntry.registrationStatus === 2 /* COMPLETED */);\r\n}\r\nfunction isAuthTokenValid(authToken) {\r\n    return (authToken.requestStatus === 2 /* COMPLETED */ &&\r\n        !isAuthTokenExpired(authToken));\r\n}\r\nfunction isAuthTokenExpired(authToken) {\r\n    var now = Date.now();\r\n    return (now < authToken.creationTime ||\r\n        authToken.creationTime + authToken.expiresIn < now + TOKEN_EXPIRATION_BUFFER);\r\n}\r\n/** Returns an updated InstallationEntry with an InProgressAuthToken. */\r\nfunction makeAuthTokenRequestInProgressEntry(oldEntry) {\r\n    var inProgressAuthToken = {\r\n        requestStatus: 1 /* IN_PROGRESS */,\r\n        requestTime: Date.now()\r\n    };\r\n    return __assign(__assign({}, oldEntry), { authToken: inProgressAuthToken });\r\n}\r\nfunction hasAuthTokenRequestTimedOut(authToken) {\r\n    return (authToken.requestStatus === 1 /* IN_PROGRESS */ &&\r\n        authToken.requestTime + PENDING_TIMEOUT_MS < Date.now());\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getId(dependencies) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var _a, installationEntry, registrationPromise;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, getInstallationEntry(dependencies.appConfig)];\r\n                case 1:\r\n                    _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\r\n                    if (registrationPromise) {\r\n                        registrationPromise.catch(console.error);\r\n                    }\r\n                    else {\r\n                        // If the installation is already registered, update the authentication\r\n                        // token if needed.\r\n                        refreshAuthToken(dependencies).catch(console.error);\r\n                    }\r\n                    return [2 /*return*/, installationEntry.fid];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getToken(dependencies, forceRefresh) {\r\n    if (forceRefresh === void 0) { forceRefresh = false; }\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var authToken;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, completeInstallationRegistration(dependencies.appConfig)];\r\n                case 1:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, refreshAuthToken(dependencies, forceRefresh)];\r\n                case 2:\r\n                    authToken = _a.sent();\r\n                    return [2 /*return*/, authToken.token];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction completeInstallationRegistration(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var registrationPromise;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, getInstallationEntry(appConfig)];\r\n                case 1:\r\n                    registrationPromise = (_a.sent()).registrationPromise;\r\n                    if (!registrationPromise) return [3 /*break*/, 3];\r\n                    // A createInstallation request is in progress. Wait until it finishes.\r\n                    return [4 /*yield*/, registrationPromise];\r\n                case 2:\r\n                    // A createInstallation request is in progress. Wait until it finishes.\r\n                    _a.sent();\r\n                    _a.label = 3;\r\n                case 3: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction deleteInstallationRequest(appConfig, installationEntry) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var endpoint, headers, request, response;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    endpoint = getDeleteEndpoint(appConfig, installationEntry);\r\n                    headers = getHeadersWithAuth(appConfig, installationEntry);\r\n                    request = {\r\n                        method: 'DELETE',\r\n                        headers: headers\r\n                    };\r\n                    return [4 /*yield*/, retryIfServerError(function () { return fetch(endpoint, request); })];\r\n                case 1:\r\n                    response = _a.sent();\r\n                    if (!!response.ok) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, getErrorFromResponse('Delete Installation', response)];\r\n                case 2: throw _a.sent();\r\n                case 3: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getDeleteEndpoint(appConfig, _a) {\r\n    var fid = _a.fid;\r\n    return getInstallationsEndpoint(appConfig) + \"/\" + fid;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction deleteInstallation(dependencies) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var appConfig, entry;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    appConfig = dependencies.appConfig;\r\n                    return [4 /*yield*/, update(appConfig, function (oldEntry) {\r\n                            if (oldEntry && oldEntry.registrationStatus === 0 /* NOT_STARTED */) {\r\n                                // Delete the unregistered entry without sending a deleteInstallation request.\r\n                                return undefined;\r\n                            }\r\n                            return oldEntry;\r\n                        })];\r\n                case 1:\r\n                    entry = _a.sent();\r\n                    if (!entry) return [3 /*break*/, 6];\r\n                    if (!(entry.registrationStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 2];\r\n                    // Can't delete while trying to register.\r\n                    throw ERROR_FACTORY.create(\"delete-pending-registration\" /* DELETE_PENDING_REGISTRATION */);\r\n                case 2:\r\n                    if (!(entry.registrationStatus === 2 /* COMPLETED */)) return [3 /*break*/, 6];\r\n                    if (!!navigator.onLine) return [3 /*break*/, 3];\r\n                    throw ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */);\r\n                case 3: return [4 /*yield*/, deleteInstallationRequest(appConfig, entry)];\r\n                case 4:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, remove(appConfig)];\r\n                case 5:\r\n                    _a.sent();\r\n                    _a.label = 6;\r\n                case 6: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Sets a new callback that will get called when Installation ID changes.\r\n * Returns an unsubscribe function that will remove the callback when called.\r\n */\r\nfunction onIdChange(_a, callback) {\r\n    var appConfig = _a.appConfig;\r\n    addCallback(appConfig, callback);\r\n    return function () {\r\n        removeCallback(appConfig, callback);\r\n    };\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction extractAppConfig(app) {\r\n    var e_1, _a;\r\n    if (!app || !app.options) {\r\n        throw getMissingValueError('App Configuration');\r\n    }\r\n    if (!app.name) {\r\n        throw getMissingValueError('App Name');\r\n    }\r\n    // Required app config keys\r\n    var configKeys = [\r\n        'projectId',\r\n        'apiKey',\r\n        'appId'\r\n    ];\r\n    try {\r\n        for (var configKeys_1 = __values(configKeys), configKeys_1_1 = configKeys_1.next(); !configKeys_1_1.done; configKeys_1_1 = configKeys_1.next()) {\r\n            var keyName = configKeys_1_1.value;\r\n            if (!app.options[keyName]) {\r\n                throw getMissingValueError(keyName);\r\n            }\r\n        }\r\n    }\r\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\r\n    finally {\r\n        try {\r\n            if (configKeys_1_1 && !configKeys_1_1.done && (_a = configKeys_1.return)) _a.call(configKeys_1);\r\n        }\r\n        finally { if (e_1) throw e_1.error; }\r\n    }\r\n    return {\r\n        appName: app.name,\r\n        projectId: app.options.projectId,\r\n        apiKey: app.options.apiKey,\r\n        appId: app.options.appId\r\n    };\r\n}\r\nfunction getMissingValueError(valueName) {\r\n    return ERROR_FACTORY.create(\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */, {\r\n        valueName: valueName\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction registerInstallations(instance) {\r\n    var installationsName = 'installations';\r\n    instance.INTERNAL.registerComponent(new Component(installationsName, function (container) {\r\n        var app = container.getProvider('app').getImmediate();\r\n        // Throws if app isn't configured properly.\r\n        var appConfig = extractAppConfig(app);\r\n        var platformLoggerProvider = container.getProvider('platform-logger');\r\n        var dependencies = {\r\n            appConfig: appConfig,\r\n            platformLoggerProvider: platformLoggerProvider\r\n        };\r\n        var installations = {\r\n            app: app,\r\n            getId: function () { return getId(dependencies); },\r\n            getToken: function (forceRefresh) {\r\n                return getToken(dependencies, forceRefresh);\r\n            },\r\n            delete: function () { return deleteInstallation(dependencies); },\r\n            onIdChange: function (callback) {\r\n                return onIdChange(dependencies, callback);\r\n            }\r\n        };\r\n        return installations;\r\n    }, \"PUBLIC\" /* PUBLIC */));\r\n    instance.registerVersion(name, version);\r\n}\r\nregisterInstallations(firebase);\n\nexport { registerInstallations };\n//# sourceMappingURL=index.esm.js.map\n","(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n  typeof define === 'function' && define.amd ? define(['exports'], factory) :\n  (global = global || self, factory(global.idb = {}));\n}(this, function (exports) { 'use strict';\n\n  function toArray(arr) {\n    return Array.prototype.slice.call(arr);\n  }\n\n  function promisifyRequest(request) {\n    return new Promise(function(resolve, reject) {\n      request.onsuccess = function() {\n        resolve(request.result);\n      };\n\n      request.onerror = function() {\n        reject(request.error);\n      };\n    });\n  }\n\n  function promisifyRequestCall(obj, method, args) {\n    var request;\n    var p = new Promise(function(resolve, reject) {\n      request = obj[method].apply(obj, args);\n      promisifyRequest(request).then(resolve, reject);\n    });\n\n    p.request = request;\n    return p;\n  }\n\n  function promisifyCursorRequestCall(obj, method, args) {\n    var p = promisifyRequestCall(obj, method, args);\n    return p.then(function(value) {\n      if (!value) return;\n      return new Cursor(value, p.request);\n    });\n  }\n\n  function proxyProperties(ProxyClass, targetProp, properties) {\n    properties.forEach(function(prop) {\n      Object.defineProperty(ProxyClass.prototype, prop, {\n        get: function() {\n          return this[targetProp][prop];\n        },\n        set: function(val) {\n          this[targetProp][prop] = val;\n        }\n      });\n    });\n  }\n\n  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return this[targetProp][prop].apply(this[targetProp], arguments);\n      };\n    });\n  }\n\n  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function Index(index) {\n    this._index = index;\n  }\n\n  proxyProperties(Index, '_index', [\n    'name',\n    'keyPath',\n    'multiEntry',\n    'unique'\n  ]);\n\n  proxyRequestMethods(Index, '_index', IDBIndex, [\n    'get',\n    'getKey',\n    'getAll',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(Index, '_index', IDBIndex, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  function Cursor(cursor, request) {\n    this._cursor = cursor;\n    this._request = request;\n  }\n\n  proxyProperties(Cursor, '_cursor', [\n    'direction',\n    'key',\n    'primaryKey',\n    'value'\n  ]);\n\n  proxyRequestMethods(Cursor, '_cursor', IDBCursor, [\n    'update',\n    'delete'\n  ]);\n\n  // proxy 'next' methods\n  ['advance', 'continue', 'continuePrimaryKey'].forEach(function(methodName) {\n    if (!(methodName in IDBCursor.prototype)) return;\n    Cursor.prototype[methodName] = function() {\n      var cursor = this;\n      var args = arguments;\n      return Promise.resolve().then(function() {\n        cursor._cursor[methodName].apply(cursor._cursor, args);\n        return promisifyRequest(cursor._request).then(function(value) {\n          if (!value) return;\n          return new Cursor(value, cursor._request);\n        });\n      });\n    };\n  });\n\n  function ObjectStore(store) {\n    this._store = store;\n  }\n\n  ObjectStore.prototype.createIndex = function() {\n    return new Index(this._store.createIndex.apply(this._store, arguments));\n  };\n\n  ObjectStore.prototype.index = function() {\n    return new Index(this._store.index.apply(this._store, arguments));\n  };\n\n  proxyProperties(ObjectStore, '_store', [\n    'name',\n    'keyPath',\n    'indexNames',\n    'autoIncrement'\n  ]);\n\n  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'put',\n    'add',\n    'delete',\n    'clear',\n    'get',\n    'getAll',\n    'getKey',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  proxyMethods(ObjectStore, '_store', IDBObjectStore, [\n    'deleteIndex'\n  ]);\n\n  function Transaction(idbTransaction) {\n    this._tx = idbTransaction;\n    this.complete = new Promise(function(resolve, reject) {\n      idbTransaction.oncomplete = function() {\n        resolve();\n      };\n      idbTransaction.onerror = function() {\n        reject(idbTransaction.error);\n      };\n      idbTransaction.onabort = function() {\n        reject(idbTransaction.error);\n      };\n    });\n  }\n\n  Transaction.prototype.objectStore = function() {\n    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n  };\n\n  proxyProperties(Transaction, '_tx', [\n    'objectStoreNames',\n    'mode'\n  ]);\n\n  proxyMethods(Transaction, '_tx', IDBTransaction, [\n    'abort'\n  ]);\n\n  function UpgradeDB(db, oldVersion, transaction) {\n    this._db = db;\n    this.oldVersion = oldVersion;\n    this.transaction = new Transaction(transaction);\n  }\n\n  UpgradeDB.prototype.createObjectStore = function() {\n    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n  };\n\n  proxyProperties(UpgradeDB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(UpgradeDB, '_db', IDBDatabase, [\n    'deleteObjectStore',\n    'close'\n  ]);\n\n  function DB(db) {\n    this._db = db;\n  }\n\n  DB.prototype.transaction = function() {\n    return new Transaction(this._db.transaction.apply(this._db, arguments));\n  };\n\n  proxyProperties(DB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(DB, '_db', IDBDatabase, [\n    'close'\n  ]);\n\n  // Add cursor iterators\n  // TODO: remove this once browsers do the right thing with promises\n  ['openCursor', 'openKeyCursor'].forEach(function(funcName) {\n    [ObjectStore, Index].forEach(function(Constructor) {\n      // Don't create iterateKeyCursor if openKeyCursor doesn't exist.\n      if (!(funcName in Constructor.prototype)) return;\n\n      Constructor.prototype[funcName.replace('open', 'iterate')] = function() {\n        var args = toArray(arguments);\n        var callback = args[args.length - 1];\n        var nativeObject = this._store || this._index;\n        var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));\n        request.onsuccess = function() {\n          callback(request.result);\n        };\n      };\n    });\n  });\n\n  // polyfill getAll\n  [Index, ObjectStore].forEach(function(Constructor) {\n    if (Constructor.prototype.getAll) return;\n    Constructor.prototype.getAll = function(query, count) {\n      var instance = this;\n      var items = [];\n\n      return new Promise(function(resolve) {\n        instance.iterateCursor(query, function(cursor) {\n          if (!cursor) {\n            resolve(items);\n            return;\n          }\n          items.push(cursor.value);\n\n          if (count !== undefined && items.length == count) {\n            resolve(items);\n            return;\n          }\n          cursor.continue();\n        });\n      });\n    };\n  });\n\n  function openDb(name, version, upgradeCallback) {\n    var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n    var request = p.request;\n\n    if (request) {\n      request.onupgradeneeded = function(event) {\n        if (upgradeCallback) {\n          upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n        }\n      };\n    }\n\n    return p.then(function(db) {\n      return new DB(db);\n    });\n  }\n\n  function deleteDb(name) {\n    return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n  }\n\n  exports.openDb = openDb;\n  exports.deleteDb = deleteDb;\n\n  Object.defineProperty(exports, '__esModule', { value: true });\n\n}));\n"]}